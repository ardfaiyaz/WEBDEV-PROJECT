<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clearance Requests</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/clearance-request.css">
    <link rel="icon" type="image/png" href="../assets/images/school-logo.png" />

</head>
<body>
    <header class="topbar">
        <div class="logo-section">
            <a href="index.html" class="logo-link">
                <img src="../assets/images/school-logo.png" alt="School Logo">
                <span class="school-name">NATIONAL<br/>UNIVERSITY</span>
            </a>
        </div>

        <nav class="top-navbar">
            <ul class="navbar-menu">
                <li class="menu-item"><a href="UserPOV.html"><i class='bx bxs-home icon-sidebar'></i> Home</a></li>
                <li class="menu-item"><a href="#"><i class='bx bxs-user icon-sidebar'></i> Profile</a></li>
                <li class="menu-item"><a href="About-us.html"><i class='bx bxs-file icon-sidebar'></i> About Us</a></li>
                <li class="menu-item"><a href="#"><i class='bx bxs-log-out icon-sidebar'></i> Logout</a></li>
            </ul>
        </nav>

        <div class="header-right-section">
            <div class="search-bar">
                <input type="text" placeholder="Search...">
                <i class='bx bx-search icon-search'></i>
            </div>
            <div class="user-section">
                <i class='bx bxs-bell'></i>
                <span class="username">Hi, user_name</span>
                <i class='bx bxs-user-circle'></i>
            </div>
        </div>
    </header>

    <div class="main-container">

        <main class="content-area">
            <div class="clearance-requests-header">
                <h2>CLEARANCE REQUESTS</h2>
            </div>
            <div class="Status-Request">
                <div class="status-box">
                    <h6>Total Requests</h6>
                    <p>600</p>
                </div>
                <div class="status-box">
                    <h6>Pending</h6>
                    <p>200</p>
                </div>
                <div class="status-box">
                    <h6>On-Going</h6>
                    <p>200</p>
                </div>
                <div class="status-box">
                    <h6>Completed</h6>
                    <p>200</p>
                </div>
            </div>

            <div class="Status">
                <ul class="navtabs">
                    <li class="Nav-item active" data-status="ALL">ALL</li>
                    <li class="Nav-item" data-status="PENDING">PENDING</li>
                    <li class="Nav-item" data-status="ON-GOING">ON-GOING</li>
                    <li class="Nav-item" data-status="COMPLETED">COMPLETED</li>
                </ul>

                <div class="Status-table">
                    <div class="Status-header">
                        <div>REQUEST ID</div>
                        <div>STUDENT ID</div>
                        <div>STUDENT NAME</div>
                        <div>PROGRAM</div>
                        <div>STATUS</div>
                        <div>DATE SUBMITTED</div>
                        <div class="actions-header">ACTIONS</div>
                    </div>

                    <!-- Existing Rows -->
                    <div class="Status-row" data-status="PENDING">
                        <div>001</div>
                        <div>2023-1701234</div>
                        <div>HEART QUINTANILLA HERNANDEZ</div>
                        <div>BSIT-MWA</div>
                        <div class="status-cell">PENDING</div>
                        <div>05-25-2025</div>
                        <div class="actions">
                            <div class="dropdown-wrapper">
                                <button class="add-remark-button dropdown-toggle">ADD REMARK <i class='bx bx-chevron-down'></i></button>
                                <div class="dropdown-menu">
                                    <a href="#" data-remark="Unpaid Fees">Unpaid Fees</a>
                                    <a href="#" data-remark="Incomplete Documents">Incomplete Documents</a>
                                    <a href="#" data-remark="Missing Signatures">Missing Signatures</a>
                                    <a href="#" data-remark="Other">Other (Specify)</a>
                                </div>
                            </div>
                            <button class="clear-button">CLEAR</button>
                        </div>
                    </div>

                    <div class="Status-row" data-status="ON-GOING">
                        <div>002</div>
                        <div>2023-1701234</div>
                        <div>HEART QUINTANILLA HERNANDEZ</div>
                        <div>BSIT-MWA</div>
                        <div class="remark-column">
                            <span class="remark-text">Unpaid fees</span>
                        </div>
                        <div>05-25-2025</div>
                        <div class="actions">
                            <button class="clear-button">CLEAR</button>
                        </div>
                    </div>

                    <div class="Status-row" data-status="COMPLETED">
                        <div>003</div>
                        <div>2023-1701234</div>
                        <div>HEART QUINTANILLA HERNANDEZ</div>
                        <div>BSIT-MWA</div>
                        <div>05-25-2025</div>
                        <div class="actions-placeholder"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- View Status Modal (integrated from the provided snippet) -->
    <div id="viewStatusModal" class="modal-overlay">
        <div class="modal-content view-status-modal-content">
            <span class="close-button">&times;</span>
            <div class="view-status-modal-inner">
                <div class="student-info-section">
                    <img src="" alt="Student Avatar" class="student-avatar-img">
                    <div class="student-text-info">
                        <h3 class="modal-student-name"></h3>
                        <p class="modal-student-id"></p>
                        <p class="modal-student-email"></p>
                    </div>
                </div>

                <div class="status-offices-section">
                    <h4>STATUS</h4>
                </div>

                <div class="requested-documents-section">
                    <h4>REQUESTED DOCUMENTS</h4>
                </div>

                <div class="remarks-section">
                    <h4>OTHER REMARKS</h4>
                    <div class="remarks-box">
                        <p class="modal-remarks">No Remarks</p>
                    </div>
                    <button class="view-consent-file-button">View Consent File</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (from original clearance requests) -->
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content">
            <i class='bx bx-question-mark modal-icon'></i>
            <h2>Confirm Clearance</h2>
            <p>Are you sure you want to clear this request?</p>
            <div class="modal-buttons">
                <button id="confirmClearBtn" class="modal-button confirm">Yes, Clear</button>
                <button id="cancelClearBtn" class="modal-button cancel">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Logic for ALL/PENDING/ON-GOING/COMPLETED tabs
const navItems = document.querySelectorAll('.Nav-item');
const rows = document.querySelectorAll('.Status-row');
const statusHeader = document.querySelector('.Status-header');

function updateTableHeaders(selectedStatus) {
    statusHeader.innerHTML = `
        <div>REQUEST ID</div>
        <div>STUDENT ID</div>
        <div>STUDENT NAME</div>
        <div>PROGRAM</div>
        <div>STATUS</div>
        <div>DATE SUBMITTED</div>
        <div class="actions-header">ACTIONS</div>
    `;

    const statusColumnHeader = statusHeader.children[4];
    const dateSubmittedColumnHeader = statusHeader.children[5];
    const actionsHeader = statusHeader.querySelector('.actions-header');

    // Adjust headers based on selected status
    if (selectedStatus === 'ON-GOING') {
        statusColumnHeader.textContent = 'REMARK';
        dateSubmittedColumnHeader.style.display = 'block';
        dateSubmittedColumnHeader.textContent = 'DATE SUBMITTED';
        if (actionsHeader) actionsHeader.style.display = 'block'; // Actions visible for ON-GOING
    } else if (selectedStatus === 'COMPLETED') {
        dateSubmittedColumnHeader.style.display = 'block';
        dateSubmittedColumnHeader.textContent = 'DATE SUBMITTED';
        if (actionsHeader) actionsHeader.style.display = 'none'; // Hide actions for COMPLETED
    } else if (selectedStatus === 'ALL') {
        dateSubmittedColumnHeader.style.display = 'block';
        dateSubmittedColumnHeader.textContent = 'DATE SUBMITTED';
        if (actionsHeader) actionsHeader.style.display = 'none'; // Hide actions for ALL
    } else { // PENDING
        statusColumnHeader.textContent = 'STATUS';
        dateSubmittedColumnHeader.style.display = 'block';
        dateSubmittedColumnHeader.textContent = 'DATE SUBMITTED';
        if (actionsHeader) actionsHeader.style.display = 'block'; // Actions visible for PENDING
    }
}

navItems.forEach(tab => {
    tab.addEventListener('click', () => {
        navItems.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const selectedStatus = tab.dataset.status.toUpperCase();
        updateTableHeaders(selectedStatus);

        rows.forEach(row => {
            const rowStatus = row.dataset.status.toUpperCase();

            const statusCell = row.querySelector('.status-cell');
            const remarkColumn = row.querySelector('.remark-column');
            const actionsDiv = row.querySelector('.actions');
            const actionsPlaceholder = row.querySelector('.actions-placeholder');
            const rowDateSubmitted = row.children[5]; // Date Submitted is always the 6th div

            // Hide all status/remark/ cells and actions by default for this row's logic
            if (statusCell) statusCell.style.display = 'none';
            if (remarkColumn) remarkColumn.style.display = 'none';
            if (actionsDiv) actionsDiv.style.display = 'none';
            if (actionsPlaceholder) actionsPlaceholder.style.display = 'none';
            if (rowDateSubmitted) rowDateSubmitted.style.display = 'block'; // Always show date submitted

            // Show row if it matches the selected status or if ALL is selected
            if (selectedStatus === 'ALL') {
                row.style.display = 'grid'; // Display the row

                if (rowStatus === 'PENDING') {
                    if (statusCell) statusCell.style.display = 'block'; // Show status cell
                    // Actions div remains hidden for ALL view, as per the header
                } else if (rowStatus === 'ON-GOING') {
                    if (remarkColumn) remarkColumn.style.display = 'block'; // Show remark column
                    // Actions div remains hidden for ALL view, as per the header
                } else if (rowStatus === 'COMPLETED') {
                    if (rowDateSubmitted) rowDateSubmitted.style.display = 'block'; // Ensure date submitted is visible
                    // Actions div remains hidden for COMPLETED and ALL view
                }
            } else if (selectedStatus === rowStatus) {
                row.style.display = 'grid'; // Display the row

                if (rowStatus === 'PENDING') {
                    if (statusCell) statusCell.style.display = 'block'; // Show status cell
                    if (actionsDiv) actionsDiv.style.display = 'flex'; // Show actions for PENDING
                } else if (rowStatus === 'ON-GOING') {
                    if (remarkColumn) remarkColumn.style.display = 'block'; // Show remark column
                    if (actionsDiv) actionsDiv.style.display = 'flex'; // Show actions for ON-GOING
                } else if (rowStatus === 'COMPLETED') {
                    if (rowDateSubmitted) rowDateSubmitted.style.display = 'block'; // Ensure date submitted is visible
                    // Actions div remains hidden for COMPLETED
                }
            } else {
                row.style.display = 'none'; // Hide the row
            }
        });
    });
});

// Simulate a click on the active tab on page load to set initial state
document.addEventListener('DOMContentLoaded', () => {
    const activeTabOnLoad = document.querySelector('.Nav-item.active');
    if (activeTabOnLoad) {
        activeTabOnLoad.click();
    }
});

// Dropdown for Add Remark button
document.querySelectorAll('.dropdown-toggle').forEach(button => {
    button.addEventListener('click', function(event) {
        event.stopPropagation(); // Prevent document click from closing immediately
        const dropdownMenu = this.nextElementSibling;
        dropdownMenu.classList.toggle('show');
    });
});

// Close dropdown when clicking outside
window.addEventListener('click', function(event) {
    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
        if (!menu.contains(event.target) && !event.target.classList.contains('dropdown-toggle')) {
            menu.classList.remove('show');
        }
    });
});


// --- Custom Confirmation Modal Logic for Clearing ---
const confirmationModal = document.getElementById('confirmationModal');
const confirmClearBtn = document.getElementById('confirmClearBtn');
const cancelClearBtn = document.getElementById('cancelClearBtn');
let currentRowToClear = null; // To store the row element that triggered the modal

document.addEventListener('click', function(event) {
    if (event.target.classList.contains('clear-button')) {
        currentRowToClear = event.target.closest('.Status-row');
        confirmationModal.classList.add('show-modal');
        document.body.classList.add('modal-open'); /* Add this class to prevent background scrolling */
    }
});

confirmClearBtn.addEventListener('click', function() {
    if (currentRowToClear) {
        // Show custom message box (instead of alert)
        const messageBox = document.createElement('div');
        messageBox.classList.add('custom-message-box');
        messageBox.innerHTML = '<p>Request cleared successfully!</p><button class="custom-message-box-close">OK</button>';
        document.body.appendChild(messageBox);
        messageBox.querySelector('.custom-message-box-close').addEventListener('click', () => {
            messageBox.remove();
        });

        currentRowToClear.dataset.status = 'COMPLETED'; // Update row data status to COMPLETED
        const statusCell = currentRowToClear.querySelector('.status-cell') || currentRowToClear.querySelector('.remark-column');
        if (statusCell) {
            statusCell.classList.remove('status-cell', 'remark-column'); // Remove old classes
        }

        // Re-trigger active tab to update table view
        const activeTab = document.querySelector('.Nav-item.active');
        if (activeTab) {
            activeTab.click();
        }
    }
    confirmationModal.classList.remove('show-modal'); // Hide modal
    document.body.classList.remove('modal-open'); /* Remove background scrolling class */
    currentRowToClear = null; // Reset stored row
});

cancelClearBtn.addEventListener('click', function() {
    // Show custom message box (instead of alert)
    const messageBox = document.createElement('div');
    messageBox.classList.add('custom-message-box');
    messageBox.innerHTML = '<p>Clearance cancelled.</p><button class="custom-message-box-close">OK</button>';
    document.body.appendChild(messageBox);
    messageBox.querySelector('.custom-message-box-close').addEventListener('click', () => {
        messageBox.remove();
    });

    confirmationModal.classList.remove('show-modal'); // Hide modal
    document.body.classList.remove('modal-open'); /* Remove background scrolling class */
    currentRowToClear = null; // Reset stored row
});
    </script>
</body>
</html>
